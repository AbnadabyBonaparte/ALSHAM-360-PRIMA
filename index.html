<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ALSHAM 360° PRIMA - CRM Inteligente com IA, Gamificação e Automações. Dashboard enterprise para gestão completa de leads e vendas." />
  <meta name="keywords" content="CRM, IA, Automação, Leads, Vendas, Dashboard, Analytics, Gamificação" />
  <meta name="author" content="ALSHAM Team" />

  <!-- 🚀 CSP reforçada (compatível com Supabase + PostHog opcional) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://*.supabase.co https://*.posthog.com;
    connect-src 'self' https://*.supabase.co wss://*.supabase.co https://*.posthog.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    img-src 'self' data: https:;
    worker-src 'self' blob:;
    frame-src 'self';
    manifest-src 'self';
  " />

  <title>ALSHAM 360° PRIMA - Dashboard Obra-Prima</title>

  <!-- 🚀 Performance: Preload & DNS Prefetch -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" as="style" />
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script" />
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" as="script" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Tailwind CSS (dev) → em prod usar buildado -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Estilos Customizados -->
  <style>
    .font-inter { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .bg-gradient-premium { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .bg-gradient-hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .text-primary { color: #3B82F6; }
    .bg-primary { background-color: #3B82F6; }

    /* Botões */
    .btn-primary {
      @apply bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none;
    }
    .btn-secondary {
      @apply bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:outline-none;
    }

    /* Skeletons */
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton 1.5s infinite;
    }
    @keyframes skeleton {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Loading bar */
    #loading-indicator {
      position: fixed; top: 0; left: 0; width: 100%; height: 4px;
      background: linear-gradient(90deg, #3B82F6, #8B5CF6, #06B6D4);
      background-size: 200% 100%;
      animation: loading 2s linear infinite;
      z-index: 9999;
    }
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .hidden { display: none !important; }
    .transition-all { transition: all 0.3s ease-in-out; }
  </style>
</head>
<body class="font-inter bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen" data-page="dashboard">
  <!-- Loading Indicator -->
  <div id="loading-indicator" class="hidden"></div>

  <!-- Skip link -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white px-4 py-2 rounded z-50">
    Pular para o conteúdo principal
  </a>

  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50 shadow-sm" role="banner">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-premium rounded-xl flex items-center justify-center" role="img" aria-label="Logo ALSHAM">
            <span class="text-white font-bold text-lg">A</span>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">ALSHAM 360° PRIMA</h1>
            <p class="text-xs text-gray-500">Dashboard Obra-Prima</p>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="hidden md:flex items-center space-x-8" role="navigation" aria-label="Navegação principal">
          <a href="#" data-page="leads" class="text-gray-600 hover:text-primary font-medium">👥 Leads</a>
          <a href="#" data-page="automacoes" class="text-gray-600 hover:text-primary font-medium">🤖 Automações</a>
          <a href="#" data-page="relatorios" class="text-gray-600 hover:text-primary font-medium">📈 Relatórios</a>
          <a href="#" data-page="gamificacao" class="text-gray-600 hover:text-primary font-medium">🎮 Gamificação</a>
          <a href="#" data-page="configuracoes" class="text-gray-600 hover:text-primary font-medium">⚙️ Configurações</a>
        </nav>

        <!-- User Area -->
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-gradient-premium rounded-full flex items-center justify-center" aria-label="Avatar do usuário">
            <span class="text-white text-sm font-semibold" id="user-initials">--</span>
          </div>
          <span class="hidden sm:block text-sm font-medium text-gray-700" id="user-name">Carregando...</span>
          <button onclick="logout()" class="text-xs text-red-600 hover:text-red-800 ml-2">Sair</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main id="main-content" role="main" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Hero -->
    <section class="bg-gradient-hero rounded-2xl p-8 text-white mb-8 relative overflow-hidden" aria-labelledby="hero-title">
      <div class="absolute inset-0 bg-black/10"></div>
      <div class="relative z-10 flex justify-between">
        <div>
          <h2 id="hero-title" class="text-3xl font-bold mb-2">🎉 <span id="hero-greeting">Carregando...</span></h2>
          <p class="text-xl mb-4">Você gerou <span class="font-bold text-yellow-300" id="hero-revenue">R$ 0</span> este mês</p>
        </div>
        <div class="text-right">
          <div class="text-sm opacity-90 mb-2">Meta Mensal</div>
          <div class="text-2xl font-bold" id="hero-goal-percentage">0%</div>
          <div class="text-sm" id="hero-goal-remaining">Calculando...</div>
        </div>
      </div>
    </section>

    <!-- KPIs -->
    <section aria-labelledby="kpis-title" class="mb-8">
      <h2 id="kpis-title" class="sr-only">Indicadores de Performance</h2>
      <div id="dashboard-kpis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100"><div class="loading-skeleton h-20 rounded"></div></div>
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100"><div class="loading-skeleton h-20 rounded"></div></div>
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100"><div class="loading-skeleton h-20 rounded"></div></div>
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100"><div class="loading-skeleton h-20 rounded"></div></div>
      </div>
    </section>

    <!-- Funil -->
    <section class="mb-8">
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-4">🔄 Funil de Vendas</h3>
        <div id="sales-funnel" class="space-y-4">
          <div class="loading-skeleton h-12 rounded"></div>
          <div class="loading-skeleton h-12 rounded"></div>
          <div class="loading-skeleton h-12 rounded"></div>
        </div>
      </div>
    </section>

    <!-- Leads -->
    <section class="mb-8">
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-4">👥 Leads Recentes</h3>
        <div id="leads-table" class="space-y-3">
          <div class="loading-skeleton h-16 rounded"></div>
          <div class="loading-skeleton h-16 rounded"></div>
        </div>
      </div>
    </section>

    <!-- Chart -->
    <section class="mb-8">
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-4">📈 Performance dos Últimos 7 Dias</h3>
        <canvas id="performanceChart" aria-label="Gráfico de performance dos últimos 7 dias"></canvas>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-500 text-sm" role="contentinfo">
    <p>&copy; 2025 ALSHAM 360° PRIMA. Sistema com dados reais do Supabase.</p>
  </footer>

  <!-- Scripts Globais -->
  <script type="module">
    // Logout
    window.logout = async () => {
      try {
        if (window.dashboardApp?.auth) await window.dashboardApp.auth.signOut();
      } catch (err) { console.error("Erro no logout:", err); }
      localStorage.clear(); sessionStorage.clear();
      location.href = '/login.html';
    };

    // Navegação
    window.navigateTo = (page) => {
      const base = location.origin;
      location.href = page === 'dashboard' ? base + '/' : `${base}/${page}.html`;
    };

    document.addEventListener('click', (e) => {
      const target = e.target.closest('[data-page]');
      if (target) { e.preventDefault(); window.navigateTo(target.dataset.page); }
    });

    // Carregamento do sistema real
    const script = document.createElement('script');
    script.type = 'module';
    script.src = '/js/dashboard.js'; // 🚀 padrão unificado
    script.onload = () => console.log('✅ Sistema real carregado!');
    script.onerror = () => {
      console.error('❌ Erro ao carregar dashboard.js - fallback ativado');
      const warn = document.createElement('div');
      warn.className = 'fixed top-0 left-0 w-full bg-orange-600 text-white p-4 text-center z-50';
      warn.innerHTML = `⚠️ Sistema em modo básico. Configure Supabase corretamente.`;
      document.body.appendChild(warn);
    };
    document.head.appendChild(script);
  </script>

  <!-- No-JS fallback -->
  <noscript>
    <div class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
      <div class="bg-white p-8 rounded-lg max-w-md text-center">
        <h2 class="text-xl font-bold text-gray-900 mb-4">JavaScript Necessário</h2>
        <p class="text-gray-600">Este sistema requer JavaScript habilitado para funcionar corretamente.</p>
      </div>
    </div>
  </noscript>
</body>
</html>
